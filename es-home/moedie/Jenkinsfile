@Library('es-jenkins-shared') _
def registry = 'artifacts.trmc.osd.mil/minerva-docker'
def base = 'extension-scaffold/es-home'
def trmc_image_version = params.TRMC_IMAGE_VERSION ? params.TRMC_IMAGE_VERSION : ""

pipeline {
    agent any

    stages {
        stage('Build dc-ui container') {
            steps {
                script {
                    withCredentials([file(credentialsId: 'trmc-npmrc', variable: 'NPMRC')]) {
                        def tag_image_ops = trmc_image_version.isEmpty() ? "" : "-t ${registry}/moesol/${base}:${trmc_image_version}"
                        sh """
                        GIT_DESCRIBE=`git describe --tags --dirty`
                        echo \${GIT_DESCRIBE}
                        docker build -t extension-scaffold/es-home . -f Dockerfile \
                        --build-arg GIT_DESCRIBE=\${GIT_DESCRIBE} \
                        --build-arg NPMRC=\${NPMRC} ${tag_image_ops}
                        """
                    }
                }
            }
        }
        stage('built-in echo testing'){
            steps {
                echo 'testing built-in echo...'
            }
        }

        stage('shared-library testEcho'){
            steps {
                testEcho()
            }
        }
    }
}